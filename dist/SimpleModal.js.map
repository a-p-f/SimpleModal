{"version":3,"file":"SimpleModal.js","sources":["../src/config.js","../src/utils.js","../src/child.js","../src/aria.js","../src/positioning.js","../src/scrollLocking.js","../src/focus.js","../src/layerManager.js","../src/SimpleModal.js"],"sourcesContent":["/*\n    Read \"configuration\" from data-simple-modal-config attribute on html element\n    Intended mainly for features on child pages, but we might add optional parent page features here, too.\n*/\nconst opts = (document.documentElement.getAttribute('simple-modal-config')||'').split(' ');\nexport default {\n    autofocus: opts.indexOf('autofocus') != -1,\n    animate: opts.indexOf('animate') != -1,\n}","export function isObject(anything) {\n    return anything !== null && typeof anything == 'object'\n}\nexport function getMessage(anything) {\n    return isObject(anything) && anything.message;\n}\nexport function postMessage(target, message) {\n    target.postMessage({message: message}, '*');\n}\n\nexport function initPreviousSiblings(iframe, initFunction) {\n    let cursor = iframe;\n    while (cursor = cursor.previousElementSibling) {\n        initFunction(cursor);\n    }\n}\nexport function releasePreviousSiblings(iframe, releaseFunction) {\n    let cursor = iframe;\n\n    // If there are any other SimpleModal layers on top of this one, we're not ready to release previous siblings\n    while (cursor = cursor.nextElementSibling) {\n        if (cursor._isSimpleModalIframe) return\n    }\n\n    cursor = iframe;\n    while (cursor = cursor.previousElementSibling) {\n        releaseFunction(cursor);\n\n        // We've reached a previous modal layer. Release it, but no more previous elements.\n        if (cursor._isSimpleModalIframe) return\n    }\n}\nexport function afterAnimation(element, then) {\n    setTimeout(\n        then, \n        parseFloat(getComputedStyle(element).animationDuration)*1000,\n    );\n}\nexport function resolve(url) {\n    const a = document.createElement('a');\n    a.href = url;\n    return a.href;\n}","import config from './config.js';\nimport {isObject, getMessage, postMessage, resolve} from './utils.js';\n\nlet ae = document.activeElement;\n\n// Listen to messages from parent\nif (window.parent != window) {\n    addEventListener('message', function(event) {\n        if (event.source != window.parent) return\n        const data = event.data;\n\n        if (getMessage(data) == 'CANCEL_SIMPLE_MODAL_ANIMATIONS') {\n            if (config.animate) {\n                cancel_animations();\n            }\n            postMessage(window.parent, 'SIMPLE_MODAL_ANIMATIONS_CANCELED');\n        }\n        if (getMessage(data) == 'SIMPLE_MODAL_LOADED_AND_REFOCUSED') {\n            // If we're animating this window, don't autofocus until animation done\n            if (config.autofocus && !config.animate) autofocus();\n        }\n    });\n    trackAndRestoreFocus();\n}\n\nfunction trackAndRestoreFocus() {\n    // track active element within this iframe\n    document.documentElement.addEventListener('focus', function() {\n        ae = document.activeElement;\n    }, true);\n\n    // when iframe regains focus, re-focus the correct element\n    addEventListener('focus', function() {\n        ae && ae.focus();\n    });\n}\n\nfunction custom_event(name, params) {\n    // Modern browsers\n    if ( typeof window.CustomEvent === \"function\" ) return new CustomEvent(name, params);\n    // IE 9+ support\n    params = params || { bubbles: false, cancelable: false, detail: undefined };\n    var event = document.createEvent('CustomEvent');\n    event.initCustomEvent(name, params.bubbles, params.cancelable, params.detail);\n    return event;\n}\nfunction fire_load() {\n    window.dispatchEvent(custom_event('simplemodal-load'));\n}\n\nexport function autofocus() {\n    const target = document.querySelector('[simple-modal-autofocus]');\n    if (target) {\n        target.focus();\n        ae = target;\n    }\n}\n\nfunction after_html_animation(callback) {\n    var h = document.documentElement;\n    var animation_seconds = parseFloat(getComputedStyle(h).animationDuration);\n    setTimeout(callback, animation_seconds*1000);\n}\n\n/*\n    Wait for load event for multiple reasons:\n    - ensure layout is finished before we start animation\n    -  getComputedStyle in after_html_animation may block (waiting on stylesheets), blocking all \"before-load\" scripts\n    - support autofocusing of dynamically added elements (as long as they are present before we run)\n*/\nlet animations_canceled = false;\nfunction cancel_animations() {\n    if (animations_canceled) return;\n    animations_canceled = true;\n    const h = document.documentElement;\n    h.classList.remove('SimpleModal-opening');\n    h.classList.remove('SimpleModal-animating');\n    config.autofocus && autofocus();\n}\naddEventListener('load', function() {\n    if (config.animate) {\n        if (document.querySelector('[autofocus]')) {\n            /*\n                Note - Safari seems to focus [autofocus] elements, even though this is an iframe. That broke our entrance animation on another site, but we haven't yet been able to replicate it. Seems to depend on page structure.\n            */\n            console.warn('autofocus not recommended when using SimpleModal animations. Can sometimes break animations in Safari, but only in certain situations.');\n        }\n        const h = document.documentElement;\n        h.classList.add('SimpleModal-opening');\n        h.classList.add('SimpleModal-animating');\n        after_html_animation(function() {\n            cancel_animations();\n            fire_load();\n        });\n    }\n    else {\n        config.autofocus && autofocus();\n        fire_load();\n    }\n});\n\nexport function animateOut(then, {leaveBackdrop=false}={}) {\n    if (!leaveBackdrop) postMessage(parent, 'ANIMATE_SIMPLE_MODAL_BACKDROP_OUT');\n\n    var h = document.documentElement;\n    h.classList.add('SimpleModal-closing');\n    h.classList.add('SimpleModal-animating');\n    if (then) after_html_animation(then);\n}\n\nfunction assertIframed() {\n    if (window.parent == window) throw new Error('This is not a SimpleModal child window (it\\'s not even in iframe)');\n}\nfunction isSameOrigin() {\n    try {\n        return Boolean(window.parent.location.hostname)\n    }\n    catch (e) {\n        return false;\n    }\n}\nfunction requiredLayerInParent() {\n    const layer = window.parent.SimpleModal && window.parent.SimpleModal.layerForWindow(window);\n    if (!layer) throw new Error(\"This is not a SimpleModal child window\");\n    return layer\n}\nfunction _close(value=null, then=null) {\n    assertIframed();\n\n    if (isSameOrigin()) {\n        const layer = requiredLayerInParent();\n        window.parent.SimpleModal.resolveLayer(layer, value);\n        then && then();\n        return\n    }\n\n    /*\n        Parent is x-origin.\n        Can't be sure we're a SimpleModal child.\n        Just try to close.\n        If we're not a SimpleModal child, parent will (probably) just ignore this message, and nothing will happen.\n    */\n    if (then) {\n        /* \n            For same-origin, we can invoke the callback synchronously.\n            For x-origin, we tried using postMessage to have the child call the function, but that doesn't work.\n            The child window seems to get cleaned up as soon as we post the message.\n            _perhaps_ we could support it if we stored a reference to the child window after we posted the message, but I don't think we should rely on a disconnected iframe receiving message events and running code.\n\n            Also, there isn't much useful that a cross-origin iframe could do in this state, anyway. The main purpose of \"then\" is to allow the (closed) child to navigate the parent.\n        */\n        throw new Error('\"then\" callback to SimpleModal.close is not supported in cross origin layers.');\n    }\n\n    parent.postMessage({\n        value: value,\n        message: 'CLOSE_SIMPLE_MODAL_CHILD',\n    }, '*');\n}\nexport function close(value=null, then=null) {\n    function do_close() {\n        _close(value, then);\n    }\n    if (config.animate) {\n        animateOut(do_close);\n    }\n    else {\n        do_close();\n    }\n}\nexport function replace(url, {animated=false}={}) {\n    // Be sure to resolve urls relative to the child location, not the parent\n    url = resolve(url);\n\n    function do_replace() {\n        parent.postMessage({\n            message: 'REPLACE_SIMPLE_MODAL',\n            url: url,\n            animated: animated,\n        }, '*');\n    }\n    if (animated) {\n        animateOut(do_replace, {leaveBackdrop: true});\n    }\n    else {\n        do_replace();\n    }\n}\nexport function reload() {\n    replace(location.href);\n}\n","import * as u from './utils.js';\n\nfunction hide_element(element) {\n    if (element._SimpleModalAriaInitialized) return\n    element._SimpleModalAriaInitialized = true\n    element._SimpleModalInitialAriaHidden = element.getAttribute('aria-hidden');\n    element.setAttribute('aria-hidden', 'true');\n}\nfunction release_element(element) {\n    if (!element._SimpleModalAriaInitialized) return\n    const hidden = element._SimpleModalInitialAriaHidden;\n    if (hidden === null) {\n        element.removeAttribute('aria-hidden');\n    }\n    else {\n        element.setAttribute('aria-hidden', hidden);\n    }\n    delete element._SimpleModalAriaInitialized;\n    delete element._SimpleModalInitialAriaHidden;\n}\n\nexport function init(layer) {\n    const iframe = layer.iframe;\n    iframe.setAttribute('role', 'dialog');\n\n    // Set aria-hidden on each previous sibling of iframe, storing initial values\n    u.initPreviousSiblings(layer.iframe, hide_element);\n}\nexport function release(layer) {\n    // restore initial aria-hidden values (unless still locked by another layer)\n    u.releasePreviousSiblings(layer.iframe, release_element);\n}\n","// Responsible for putting in DOM, and positioning on screen\nfunction cover(iframe, container) {\n    const rect = container.getBoundingClientRect();\n    const s = iframe.style;\n    const h = document.documentElement;\n\n    const left = Math.max(0, rect.left);\n    s.left = left+'px';\n    s.width = Math.min(\n        rect.right-left,\n        h.clientWidth-left,\n    ) + 'px';\n    const top = Math.max(0, rect.top);\n    s.top = top+'px';\n    s.height = Math.min(\n        rect.bottom-top,\n        h.clientHeight-top,\n    ) + 'px';\n}\n\nexport function init(element, container) {\n    (container||document.body).appendChild(element);\n    const s = element.style;\n\n    s.position = 'fixed';\n    s.border = 'none';\n    s.padding = 0;\n\n    // This is the maximum supported z-index in current browsers (max 32 bit signed int), but the CSS spec doesn't actually specify this\n    // We need to set this value for IE, which doesn't work when you set z-index to any higher number\n    s.zIndex = 2147483647;\n\n    // This is MAX_SAFE_INTEGER in JS\n    // This is larger than the maximum supported z-index in any current browser\n    // In IE, this has no effect.\n    // In other browsers, this always seems to set z-index to the highest supported value, and should protect against future increases in that value.\n    s.zIndex = 9007199254740991;\n\n    if (container) {\n        const position = cover.bind(null, element, container);\n        element._simple_modal_position = position;\n        position();\n\n        addEventListener('scroll', position, true);\n        addEventListener('resize', position);\n    }\n    else {\n        s.left = s.top = '0px';\n        s.width = s.height = '100%';\n    }\n}\n\n// layer manager can tell us to update explicitly\nexport function update(element, container) {\n    if (container) {\n        element._simple_modal_position();\n    }\n}\n\nexport function release(element, container) {\n    element.parentElement && element.parentElement.removeChild(element);\n    if (container) {\n        const position = element._simple_modal_position;\n        removeEventListener('scroll', position, true);\n        removeEventListener('resize', position);\n    }\n}","/*\n    This may be overly complicated.\n    In most situations, we just want to replicate the behaviour of \n        overscroll-behaviour: contain\n    but browser support isn't great yet, and I don't know if it even works on iframes.\n\n    In certain situtations, that isn't even the behaviour we want.\n    Imagine:\n    HEADER\n    --------------------------\n            |  \n    SIDEBAR | MAIN\n            |  \n            |  \n            |  \n\n    And the modal is set to cover MAIN.\n    Here, if the entire page scrolls (ie. because sidebar is long), we want to let the page scroll.\n    If MAIN scrolls, however, we _do_ want to lock it.\n*/\nfunction ScrollLock(element) {\n    const style = element.style;\n    let count = 0;\n    let scrollTop, scrollLeft, overflowX, overflowY, maxWidth;\n\n    function fixScroll() {\n        element.scrollTop = scrollTop;\n        element.scrollLeft = scrollLeft;\n    }\n    function increment() {\n        count++;\n        if (count==1) lock();\n    }\n    function decrement() {\n        count--;\n        if (count==0) unlock();\n    }\n    function lock() {\n        scrollTop = element.scrollTop;\n        scrollLeft = element.scrollLeft;\n\n        // Save values so we can restore\n        overflowX = style.overflowX;\n        overflowY = style.overflowY;\n        maxWidth = style.maxWidth;\n\n        /*\n            Lock element dimensions.\n            In some browsers/configurations, toggling overflow will cause scrollbars to hide.\n            Lock dimensions so that the document doesn't reflow.\n        */\n        style.maxWidth = element.clientWidth + 'px';\n\n        // Lock scrolling\n        // ONLY lock if element actually \"has a scrollbar\"\n        // Otherwise, we can change how margin collapsing works, if the element currently has no overflow\n        if (element.scrollWidth > element.clientWidth) style.overflowX = 'hidden';\n        if (element.scrollHeight > element.clientHeight) style.overflowY = 'hidden';\n\n        /*\n            Note - even though we've set overflow hidden, that doesn't stop programmatic scrolling.\n            If the modal's initial content is positioned offscreen (ie. if it is going to animate into view), then some browsers (safari) may try to scroll the container to put the child window in view.\n            So we still need a scroll listener  to reset such browser-induced scrolling.\n        */\n        element.addEventListener('scroll', fixScroll);\n    }\n    function unlock() {\n        style.maxWidth = maxWidth;\n        style.overflowX = overflowX;\n        style.overflowY = overflowY;\n\n        element.removeEventListener('scroll', fixScroll);\n    }\n    return {increment, decrement}\n}\n\nfunction increment_lock(element) {\n    element._SimpleModalScrollLock = element._SimpleModalScrollLock || ScrollLock(element);\n    element._SimpleModalScrollLock.increment();\n}\nfunction decrement_lock(element) {\n    element._SimpleModalScrollLock.decrement();\n}\nfunction elements_to_lock(layer) {\n    /*\n        In the \"normal\" situation, we're appending iframe to body, but \"covering\" the entire <html> element. \n\n        Depending on style/layout, scrollbar could be on <html>, <body>, or both.\n        So we need to lock both.\n    */\n    if (layer.container) return [layer.container]\n    return [document.documentElement, document.body];\n}\nexport function init(layer) {\n    elements_to_lock(layer).forEach(increment_lock);\n}\nexport function release(layer) {\n    elements_to_lock(layer).forEach(decrement_lock);\n}","/*\nResponsible for:\n- preventing focus of \"covered\" elements\n- focusing layers when opened/reloaded\n- restoring focus when layers are closed\n*/\n\nimport * as u from './utils.js';\n\n/*\n    Prevent programmatic/browser-automatic focusing of covered elements.\n    \n    We shouldn't have to do this, but we found a case (hard to reproduce), where Safari was focusing a username input on the parent page when it had a modal open. This feature is mainly to protect against that.\n*/\naddEventListener('focus', function(event) {\n    if (event.target.hasOwnProperty('_SimpleModalInitialTabIndex')) {\n        event.target.blur();\n    }\n}, true);\n\n\n// Fairly inclusive list of (potentially) focusable elements.\n// I used this for guidance: https://allyjs.io/data-tables/focusable.html\nconst POTENTIALLY_FOCUSABLE = 'a,button,input,textarea,select,summary,[contenteditable],area,audio,video,object,embed,svg,iframe';\n\nfunction getPotentiallyFocusableChildren(layer) {\n    return (layer.container || document.body).querySelectorAll(POTENTIALLY_FOCUSABLE);\n}\nfunction block(e) {\n    // Do nothing if already blocked\n    if (e.hasOwnProperty('_SimpleModalInitialTabIndex')) return\n\n    e._SimpleModalInitialTabIndex = e.getAttribute('tabindex');\n    e.setAttribute('tabindex', -1);\n}\nfunction unblock(e) {\n    const v = e._SimpleModalInitialTabIndex;\n\n    // This element wasn't blocked by us. Leave tabindex alone.\n    if (typeof v == 'undefined') return\n\n    if (v == null) e.removeAttribute('tabindex');\n    else e.setAttribute('tabindex', v);\n    delete e._SimpleModalInitialTabIndex;\n}\nexport function init(layer, isFirstLayer) {\n    /*\n        TODO - users might not be happy to have us messing with tabindex (even if only temporarily).\n        We should offer an option to opt-out\n    */\n    const focusable = getPotentiallyFocusableChildren(layer);\n    for (let i = focusable.length - 1; i >= 0; i--) {\n        if (focusable[i] != layer.iframe) block(focusable[i]);\n    }\n\n    if (layer.replaces) {\n        layer.initialActiveElement = layer.replaces.initialActiveElement;\n\n        // This one shouldn't change focus when it's released\n        layer.replaces.initialActiveElement = null;\n    }\n    else {\n        layer.initialActiveElement = document.activeElement;\n    }\n\n    layer.iframe.focus();\n}\nfunction is_covered(e, excluding) {\n    let cursor = e;\n    while (cursor = cursor.nextElementSibling) {\n        if (cursor._isSimpleModalIframe && cursor != excluding) return true\n    }\n    if (e.parentElement) return is_covered(e.parentElement, excluding);\n    return false;\n}\n// TODO - more efficient algorithm? Could work top-down/backwards\n// Getting it right in all scenarios (including concurrent modals, in different containers) isn't straight-forward\n// This is a bit of a brute-force approach, but it should be correct\nexport function release(layer) {\n    const focusable = document.querySelectorAll(POTENTIALLY_FOCUSABLE);\n    for (let i = focusable.length - 1; i >= 0; i--) {\n        const e = focusable[i];\n        // Note - our iframe might not have been removed yet. Be sure we don't count it in the is_covered check\n        if (!is_covered(e, layer.iframe)) unblock(e);\n    }\n    const ae = layer.initialActiveElement;\n    if (ae && ae.tabIndex >= 0) ae.focus();\n }","import * as aria from './aria.js';\nimport * as positioning from './positioning.js';\nimport * as scrollLocking from './scrollLocking.js';\nimport * as focus from './focus.js';\nimport * as u from './utils.js';\n\nimport {isObject, getMessage, postMessage} from './utils.js';\n\nconst layers = [];\nfunction makeIframe(sandbox) {\n    const iframe = document.createElement('iframe');\n\n    // Not used by us anywhere, but can be useful for external code to identify our iframes\n    iframe.classList.add('SimpleModalIframe');\n\n    iframe._isSimpleModalIframe = true;\n    \n    const s = iframe.style;\n\n    // Don't make the iframe visible until it has loaded\n    // This makes it easier to animate in\n    // Use opacity, rather than visibility, because browser don't let you focus hidden elements\n    // May be more performant to toggle opacity, too\n    // s.visibility = 'hidden';\n    s.opacity = 0;\n\n    if (sandbox !== null) {\n        iframe.setAttribute('sandbox', sandbox);\n    }\n    return iframe;\n}\nfunction reveal(iframe) {\n    iframe.style.opacity = '';\n}\nfunction is_same_origin(iframe) {\n    try {\n        return Boolean(iframe.contentDocument);\n    } catch(e) {return false}\n}\nfunction should_set_opaque_background(iframe) {\n    // If the iframe is x-origin, we cannot  test the html element.\n    // Have to assume the users have set it properly.\n    if (!is_same_origin(iframe)) return false; \n\n    const s = getComputedStyle(iframe.contentDocument.documentElement);\n    const bc = s.backgroundColor;\n    return (bc == 'transparent' || bc == 'rgba(0, 0, 0, 0)') && s.backgroundImage == 'none';\n}\nfunction layerLoaded(layer) {\n    const iframe = layer.iframe;\n    // Server-generated error pages won't have any background color.\n    // It's really confusing when these load as a modal layer.\n    // To help with that, if the background of the <html> element is totally transparent, we'll set a background color on the iframe\n    iframe.style.backgroundColor = should_set_opaque_background(iframe) ? 'white' : '';\n\n    if (layer.replaces) {\n        postMessage(iframe.contentWindow, 'CANCEL_SIMPLE_MODAL_ANIMATIONS');\n        // Don't reveal until it tells us it has canceled animations\n    }\n    else {\n        // Only needed on first load, but no harm running every load\n        reveal(iframe);\n    }\n\n    // Seems to be needed in IE - iframe blurs when it reloads\n    // We want to be sure to focus it now, before we call the onload callback (rather than waiting for our focus listener)\n    if (iframe != document.activeElement && iframe.tabindex != -1) {\n        iframe.focus();\n    }\n    postMessage(iframe.contentWindow, 'SIMPLE_MODAL_LOADED_AND_REFOCUSED');\n\n    layer.onload && layer.onload(layer.iframe.contentWindow);\n}\nexport function layerForWindow(w) {\n    for (let i = 0; i < layers.length; i++) {\n        if (layers[i].iframe.contentWindow == w) return layers[i];\n    }\n}\nexport function top() {\n    // Notice - will be undefined if no layers open\n    return layers[layers.length-1];\n}\nfunction addBackdrop(layer) {\n    const backdrop = document.createElement('div');\n    backdrop.classList.add('SimpleModalBackdrop');\n    backdrop.classList.add('animating');\n    positioning.init(backdrop, layer.container);\n    u.afterAnimation(backdrop, function() {\n        backdrop.classList.remove('animating');\n    });\n    layer.backdrop = backdrop;\n}\nexport function open(layer, src) {\n    // If this layer is replacing another, it will already have a backdrop\n    if (!layer.backdrop) addBackdrop(layer);\n\n    const iframe = makeIframe(layer.sandbox);\n    layer.iframe = iframe;\n    layers.push(layer);\n\n    const isFirstLayer = layers.length == 1;\n\n    scrollLocking.init(layer);\n    iframe.src = src;\n    positioning.init(layer.iframe, layer.container);\n    focus.init(layer, isFirstLayer);\n    aria.init(layer);\n\n    /*\n        We _should_ be able to do this.\n        However, we've run into issues when integrating on external sites, where 3rd party code call stopPropagation on the load event.\n        By using a capturing event listener (on document), this issue is less likely to arise.\n    */\n    // iframe.addEventListener('load', layerLoaded.bind(null, layer));\n}\ndocument.addEventListener('load', function(e) {\n    const w = e.target.contentWindow;\n    const layer = w && layerForWindow(w);\n    if (layer) layerLoaded(layer);\n}, true);\n\nexport function resolve(layer, value) {\n    // Remove it from list\n    const index = layers.indexOf(layer);\n    if (index==-1) throw new Error('Layer is not in layers.');\n    layers.splice(index, 1);\n\n    // If the layer still has a backdrop, remove it\n    const backdrop = layer.backdrop;\n    if (backdrop) removeBackdrop(backdrop, layer.container);\n\n    const isLastLayer = layers.length == 0;\n\n    aria.release(layer);\n    focus.release(layer, isLastLayer);\n    positioning.release(layer.iframe, layer.container);\n    scrollLocking.release(layer);\n\n    layer.onclose && layer.onclose(value);\n    layer.promiseResolver && layer.promiseResolver(value);\n}\nexport function replace(layer, url, animated=false) {\n    const next = {\n        sandbox: layer.sandbox,\n        onload: layer.onload,\n        onclose: layer.onclose,\n        promiseResolver: layer.promiseResolver,\n        container: layer.container,\n        backdrop: layer.backdrop,\n    }\n\n    // Ensure nothing happens when remove current, or if it loads again\n    layer.onload = null;\n    layer.onclose = null;\n    layer.promiseResolver = null;\n    layer.backdrop = null;\n\n    if (animated) {\n        // Close current layer, opening the next one after exit animation runs\n        layer.onclose = open.bind(null, next, url);\n        resolve(layer);\n    }\n    else {\n        // Open the next layer, and have it replace the current one without animation once loaded\n        next.replaces = layer;\n        open(next, url);\n    }\n}\nexport function updatePositions() {\n    for (var i = 0; i < layers.length; i++) {\n        positioning.update(layers[i].iframe, layers[i].container);\n    }\n}\nfunction animateBackdropOut(layer) {\n    const backdrop = layer.backdrop;\n    if (!backdrop) return\n\n    // tell resolve not remove the backdrop - let the exit animation finish\n    layer.backdrop = null;\n\n    backdrop.classList.add('animating');\n    backdrop.classList.add('closing');\n    u.afterAnimation(backdrop, removeBackdrop.bind(null, backdrop, layer.container));\n}\nfunction removeBackdrop(backdrop, container) {\n    positioning.release(backdrop, container);\n}\naddEventListener('message', function(event) {\n    const layer = layerForWindow(event.source);\n    if (!layer) return\n    \n    const data = event.data;\n\n    // x-origin child explicitly asked to be closed\n    if (getMessage(data) == 'CLOSE_SIMPLE_MODAL_CHILD') {\n        resolve(layer, event.data.value);\n    }\n    if (getMessage(data) == 'REPLACE_SIMPLE_MODAL') {\n        replace(layer, data.url, data.animated);\n    }\n    if (getMessage(data) == 'SIMPLE_MODAL_ANIMATIONS_CANCELED') {\n        reveal(layer.iframe);\n        resolve(layer.replaces);\n        layer.replaces = null;\n    }\n    if (getMessage(data) == 'ANIMATE_SIMPLE_MODAL_BACKDROP_OUT') {\n        animateBackdropOut(layer);\n    }\n});\n","// child.js adds global event listeners\nimport './child.js';\nimport * as layerManager from './layerManager.js';\n\n// Parent window API\nexport function open(url, {\n    onload=null,\n    onclose=null,\n    // Currently only used for testing (fake x-origin)\n    // TODO - should we document? Users might want sandbox x-origin frames\n    sandbox=null,\n    container=null,\n}={}) {\n    const layer = {\n        sandbox: sandbox,\n        onload: onload,\n        onclose: onclose,\n        promiseResolver: null,\n        container: container,\n    }\n    layerManager.open(layer, url);\n\n    // Return a promise, but only if Promise() is implemented in browser\n    try {\n        return new Promise((resolve, reject) => {\n            layer.promiseResolver = resolve;\n        });\n    } catch (e) {}\n}\nexport function closeChild(value) {\n    const layer = layerManager.top();\n    if (!layer) throw new Error('No modal window is open');\n    layerManager.resolve(layer, value);   \n}\n\n// public child window API\nexport {\n    close,\n    reload,\n    replace,\n    animateOut,\n} from './child.js';\n\nexport {\n    // TODO - document\n    updatePositions,\n\n    // various functions that child window needs, but we probably won't document\n    layerForWindow, \n    resolve as resolveLayer, \n    replace as replaceLayer\n} from './layerManager.js';\n"],"names":["opts","document","documentElement","getAttribute","split","autofocus","indexOf","animate","isObject","anything","getMessage","message","postMessage","target","initPreviousSiblings","iframe","initFunction","cursor","previousElementSibling","releasePreviousSiblings","releaseFunction","nextElementSibling","_isSimpleModalIframe","afterAnimation","element","then","setTimeout","parseFloat","getComputedStyle","animationDuration","resolve","url","a","createElement","href","ae","activeElement","window","parent","addEventListener","event","source","data","config","cancel_animations","trackAndRestoreFocus","focus","custom_event","name","params","CustomEvent","bubbles","cancelable","detail","undefined","createEvent","initCustomEvent","fire_load","dispatchEvent","querySelector","after_html_animation","callback","h","animation_seconds","animations_canceled","classList","remove","console","warn","add","animateOut","leaveBackdrop","assertIframed","Error","isSameOrigin","Boolean","location","hostname","e","requiredLayerInParent","layer","SimpleModal","layerForWindow","_close","value","resolveLayer","close","do_close","replace","animated","do_replace","reload","hide_element","_SimpleModalAriaInitialized","_SimpleModalInitialAriaHidden","setAttribute","release_element","hidden","removeAttribute","init","u","release","cover","container","rect","getBoundingClientRect","s","style","left","Math","max","width","min","right","clientWidth","top","height","bottom","clientHeight","body","appendChild","position","border","padding","zIndex","bind","_simple_modal_position","update","parentElement","removeChild","removeEventListener","ScrollLock","count","scrollTop","scrollLeft","overflowX","overflowY","maxWidth","fixScroll","increment","lock","decrement","unlock","scrollWidth","scrollHeight","increment_lock","_SimpleModalScrollLock","decrement_lock","elements_to_lock","forEach","hasOwnProperty","blur","POTENTIALLY_FOCUSABLE","getPotentiallyFocusableChildren","querySelectorAll","block","_SimpleModalInitialTabIndex","unblock","v","isFirstLayer","focusable","i","length","replaces","initialActiveElement","is_covered","excluding","tabIndex","layers","makeIframe","sandbox","opacity","reveal","is_same_origin","contentDocument","should_set_opaque_background","bc","backgroundColor","backgroundImage","layerLoaded","contentWindow","tabindex","onload","w","addBackdrop","backdrop","positioning","open","src","push","scrollLocking","aria","index","splice","removeBackdrop","onclose","promiseResolver","next","updatePositions","animateBackdropOut","layerManager","Promise","reject","closeChild"],"mappings":"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"}